<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Copy corrections &mdash; Microbial Ecology Protocols 0.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/labibi.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Microbial Ecology Protocols 0.2 documentation" href="../index.html" />


<style type="text/css">
<!-- github-based editing disabled; set github_base_account
     and github_project -->
#editor-trap.toggled {
  display: none;
}
</style>



<!-- Google Analytics JS is disabled; set google_analytics_id -->


  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">Microbial Ecology Protocols 0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  
  <div class="section" id="copy-corrections">
<h1>Copy corrections<a class="headerlink" href="#copy-corrections" title="Permalink to this headline">Â¶</a></h1>
<p>Copy corrections is based on <a class="reference external" href="http://www.ncbi.nlm.nih.gov/pubmed/24708850">copyrighter</a>. One copy database for each Greengene taxon at each level is provided by the tool. We will use that database for correcting our Greengene taxonomy abundance and OTU abundance.</p>
<p>Set up a directory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd</span> /usr/local/notebooks
<span class="c">### set up directory</span>
mkdir -p ./workdir/copy_correction
</pre></div>
</div>
<p>Set up parameters:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">Prefix</span><span class="o">=</span><span class="s1">&#39;SS&#39;</span>    <span class="c"># name for the analysis run</span>
<span class="nv">Script_dir</span><span class="o">=</span><span class="s1">&#39;./SSUsearch/scripts&#39;</span>
<span class="nv">Wkdir</span><span class="o">=</span><span class="s1">&#39;./workdir&#39;</span>
<span class="nv">Design</span><span class="o">=</span><span class="s1">&#39;./data/test/SS.design&#39;</span>
<span class="nv">Otu_dist_cutoff</span><span class="o">=</span><span class="s1">&#39;0.05&#39;</span>
<span class="nv">Copy_db</span><span class="o">=</span><span class="s1">&#39;./data/SSUsearch_db/Copy_db.copyrighter.txt&#39;</span>

<span class="nv">Script_dir</span><span class="o">=</span><span class="k">$(</span>readlink -f <span class="nv">$Script_dir</span><span class="k">)</span>
<span class="nv">Wkdir</span><span class="o">=</span><span class="k">$(</span>readlink -f <span class="nv">$Wkdir</span><span class="k">)</span>
<span class="nv">Design</span><span class="o">=</span><span class="k">$(</span>readlink -f <span class="nv">$Design</span><span class="k">)</span>
<span class="nv">Copy_db</span><span class="o">=</span><span class="k">$(</span>readlink -f <span class="nv">$Copy_db</span><span class="k">)</span>
</pre></div>
</div>
<p>Go to the directory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd</span> ./workdir/copy_correction
</pre></div>
</div>
<p>Get input files from clustering directory:</p>
<div class="highlight-bash"><div class="highlight"><pre>ln -sf <span class="nv">$Wkdir</span>/clust/<span class="nv">$Prefix</span>.biom
ln -sf <span class="nv">$Wkdir</span>/clust/<span class="nv">$Prefix</span>.list
</pre></div>
</div>
<p>Get Greengene taxonomy:</p>
<div class="highlight-bash"><div class="highlight"><pre>cat <span class="nv">$Wkdir</span>/*.ssu.out/*.gg.taxonomy &gt; <span class="nv">$Prefix</span>.taxonomy
mothur <span class="s2">&quot;#classify.otu(list=</span><span class="nv">$Prefix</span><span class="s2">.list, taxonomy=</span><span class="nv">$Prefix</span><span class="s2">.taxonomy, label=</span><span class="nv">$Otu_dist_cutoff</span><span class="s2">)&quot;</span>
mv SS.0.03.cons.taxonomy SS.cons.taxonomy
mv SS.0.03.cons.tax.summary SS.cons.tax.summary
</pre></div>
</div>
<p>Get original OTU table:</p>
<div class="highlight-bash"><div class="highlight"><pre>mothur <span class="s2">&quot;#make.shared(biom=</span><span class="nv">$Prefix</span><span class="s2">.biom)&quot;</span>
</pre></div>
</div>
<p>Do copy correction and even sampling:</p>
<div class="highlight-bash"><div class="highlight"><pre>python <span class="nv">$Script_dir</span>/copyrighter-otutable.py <span class="nv">$Copy_db</span> <span class="nv">$Prefix</span>.cons.taxonomy <span class="nv">$Prefix</span>.shared <span class="nv">$Prefix</span>.cc.shared
mv <span class="nv">$Prefix</span>.cc.shared <span class="nv">$Prefix</span>.shared
mothur <span class="s2">&quot;#make.biom(shared=</span><span class="nv">$Prefix</span><span class="s2">.shared, constaxonomy=</span><span class="nv">$Prefix</span><span class="s2">.cons.taxonomy);&quot;</span>
mv <span class="nv">$Prefix</span>.userLabel.biom <span class="nv">$Prefix</span>.biom
rm -f mothur.*.logfile
</pre></div>
</div>
<p><strong>SS.biom</strong> can be further used for diversity analysis, important but not focus of this tutorial (details see <a class="reference external" href="http://www.mothur.org/wiki/454_SOP">mothur wiki</a>):</p>
<div class="highlight-bash"><div class="highlight"><pre>mothur <span class="s2">&quot;#make.shared(biom=</span><span class="nv">$Prefix</span><span class="s2">.biom); sub.sample(shared=</span><span class="nv">$Prefix</span><span class="s2">.shared); summary.single(calc=nseqs-coverage-sobs-chao-shannon-invsimpson); dist.shared(calc=braycurtis); pcoa(phylip=</span><span class="nv">$Prefix</span><span class="s2">.userLabel.subsample.braycurtis.userLabel.lt.dist); nmds(phylip=</span><span class="nv">$Prefix</span><span class="s2">.userLabel.subsample.braycurtis.userLabel.lt.dist); amova(phylip=</span><span class="nv">$Prefix</span><span class="s2">.userLabel.subsample.braycurtis.userLabel.lt.dist, design=</span><span class="nv">$Design</span><span class="s2">); tree.shared(calc=braycurtis); unifrac.weighted(tree=</span><span class="nv">$Prefix</span><span class="s2">.userLabel.subsample.braycurtis.userLabel.tre, group=</span><span class="nv">$Design</span><span class="s2">, random=T)&quot;</span>
rm -f mothur.*.logfile<span class="p">;</span>
rm -f *.rabund
</pre></div>
</div>
</div>




<!-- disqus commenting disabled; set disqus_shortname -->

          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">Microbial Ecology Protocols 0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Jiarong Guo.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>




<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', ]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


  </body>
</html>